function showFocusSearchFields(b){$("#name_row").hide();$("#givenname_cell1").hide();$("#givenname_cell2").hide();$("#place_row").hide();$("#source_place_row").hide();$("#birth_row").hide();$("#death_row").hide();$("#father_row").hide();$("#mother_row").hide();$("#spouse_row").hide();$("#husband_row").hide();$("#wife_row").hide();$("#marriage_row").hide();$("#placename_row").hide();$("#subject_row").hide();$("#source_title_row").hide();$("#author_row").hide();$("#title_row").hide();$("#coverage_row").hide();$("#watch option[value='ws']").attr("disabled","disabled");var a;var d=$("#ns").val();switch(d){case"All":$("#name_row").show();$("#givenname_cell1").show();$("#givenname_cell2").show();a="#input_g";$("#place_row").show();break;case"Image":$("#name_row").show();$("#givenname_cell1").show();$("#givenname_cell2").show();a="#input_g";$("#place_row").show();$("#title_row").show();break;case"Article":case"User":case"Transcript":$("#name_row").show();a="#input_s";$("#place_row").show();$("#title_row").show();break;case"Source":$("#name_row").show();a="#author_row input";$("#place_row").show();$("#source_place_row").show();$("#subject_row").show();$("#source_title_row").show();$("#coverage_row").show();$("#author_row").show();break;case"MySource":$("#name_row").show();a="#input_s";$("#place_row").show();$("#author_row").show();$("#title_row").show();break;case"Person":$("#name_row").show();$("#givenname_cell1").show();$("#givenname_cell2").show();a="#input_g";$("#birth_row").show();$("#death_row").show();$("#father_row").show();$("#mother_row").show();$("#spouse_row").show();if(!$("#watch").attr("disabled")){$("#watch option[value='ws']").removeAttr("disabled")}break;case"Family":$("#husband_row").show();a="#husband_row input";$("#wife_row").show();$("#marriage_row").show();if(!$("#watch").attr("disabled")){$("#watch option[value='ws']").removeAttr("disabled")}break;case"Place":$("#placename_row").show();a="#placename_row input";break;case"Repository":$("#place_row").show();a="#place_row input";$("#title_row").show();break;default:$("#title_row").show();a="#title_row input";break}if(d!="Person"&&d!="Family"&&$("#watch option:selected").val()=="ws"){$("#watch").val("wu")}var c=$(a);if(b&&c.length>0){c[0].focus()}}function showSearchFields(){showFocusSearchFields(false)}function bindExactClick(){$("#ecp").change(function(){var a=$("#ecp option:selected").val();if(a=="e"||a=="c"){$("#sort option[value='title']").removeAttr("disabled");$("#sort option[value='date']").removeAttr("disabled")}else{$("#sort").val("score");$("#sort option[value='title']").attr("disabled","disabled");$("#sort option[value='date']").attr("disabled","disabled")}}).trigger("change")}function closeWindow(){window.close()}function getFormValue(b){var a=$("#input_"+b);if(a.length>0){return a.val()}else{return""}}function updateTarget(g,d,j){var b=getAcStorageKey(d);try{var h=$.jStorage.get(b,"");if(!h||h.length==0){h=new Array()}else{h=h.split("|");for(var a=0;a<h.length;a++){if(h[a]==j){h.splice(a,1);break}}}if(h.length>=100){h.pop()}h.unshift(j);$.jStorage.set(b,h.join("|"))}catch(f){}if(g=="gedcom"){try{if(parent&&parent.review){var c=(navigator.appName.indexOf("Microsoft")!=-1)?parent.review.window.gedcom:parent.review.document.gedcom;if(c&&c.matchFound){c.matchFound(j)}}}catch(f){alert("Unable to communicate with gedcom review program.  Please refresh your browser window.")}}else{if(g!="AddPage"&&g!="AddSpouse"&&g!="AddFather"&&g!="AddMother"){window.opener.document.getElementById(g).value=j}}}function getTrees(){var a="";$(".treeCheckbox").each(function(c){var b=$(this);if(b.attr("checked")){a+="|tree="+b.attr("name")}});return a}function generateRsargs(b){var a="";for(var c in b){a+="|"+c+"="+b[c]}return a}function generateUrlParms(b){var a="";for(var c in b){a+="&"+c+"="+encodeURIComponent(b[c])}return a}function selectPage(f,k,h){var j={};h=decodeURIComponent(h);var b=false;if(k=="Person"){var g=getFormValue("pf");var e=getFormValue("sf");j={pf:g,sf:e};b=g||e}else{if(k=="Family"){var i=getFormValue("ht");var d=getFormValue("wt");var c=getFormValue("ct");j={ht:i,wt:d,ct:c};b=i||d||c}}updateTarget(f,k,h);if(f=="AddPage"&&b){window.location="/w/index.php?title="+encodeURIComponent(k+":"+h)+"&action=edit"+generateUrlParms(j)}else{if(f=="AddPage"||f=="gedcom"){window.location="/w/index.php?title="+encodeURIComponent(k+":"+h)}else{if(k=="Person"||k=="Family"){var a=$("#pleasewait");if(!a.is(":visible")){a.css("display","inline");$.get("/w/index.php",{action:"ajax",rs:"wfAddPage",rsargs:"update=true|ns="+k+"|title="+h+generateRsargs(j)+getTrees()},function(o){var n=o.getElementsByTagName("addpage");var l=n[0].getAttribute("status");if(l==0){if(f=="AddFather"){j.wg=getFormValue("wg");j.ws=getFormValue("ws");promptForPerson(f,h,j)}else{setTimeout(closeWindow,10)}}else{var m=n[0].getAttribute("error");alert(m)}})}}else{setTimeout(closeWindow,10)}}}}function promptForPerson(f,h,i){var b={};var g="family";if(f.substr(0,16)=="spouse_of_family"&&((i.gnd=="M"&&(i.wg||i.ws))||(i.gnd=="F"&&(i.hg||i.hs)))){if(i.gnd=="M"){b.g=i.wg;b.s=i.ws;b.gnd="F"}else{b.g=i.hg;b.s=i.hs;b.gnd="M"}b.sf=h;f="AddSpouse"}else{if(f.substr(0,15)=="child_of_family"&&(i.hg||i.hs)){b.sf=h;b.g=i.hg;b.s=i.hs;b.wg=i.wg;b.ws=i.ws;b.gnd="M";f="AddFather"}else{if((f=="AddFather"||(f.substr(0,15)=="child_of_family")&&!(i.hg||i.hs))&&(i.wg||i.ws)){b.sf=(f=="AddFather"?i.sf:h);b.g=i.wg;b.s=i.ws;b.gnd="F";if(f=="AddFather"){g="father's"}f="AddMother"}else{f=""}}}if(f){var d=(b.g=="Unknown"?"":b.g);var e=(b.s=="Unknown"?"":b.s);var a=(d&&e?d+" "+e:(d||e));var c=$("<div></div>").html("The "+g+" page has been added. Do you want to add a page for "+escapeHtml(a)+"?").dialog({title:"Add a page for "+escapeHtml(a)+"?",resizable:false,modal:true,buttons:{Yes:function(){$(this).dialog("destroy");window.location="/wiki/Special:AddPage?namespace=Person&target="+encodeURIComponent(f)+generateUrlParms(b)},No:function(){$(this).dialog("destroy");promptForPerson(f,h,b)}}})}else{setTimeout(closeWindow,10)}}function addPage(b,d,a){var c=$("#pleasewait");if(!c.is(":visible")){c.css("display","inline");$.get("/w/index.php",{action:"ajax",rs:"wfAddPage",rsargs:"update="+(d=="AddPage"||d=="gedcom"?"false":"true")+"|ns="+b+generateRsargs(a)+getTrees()},function(h){var g=h.getElementsByTagName("addpage");var e=g[0].getAttribute("status");var i=g[0].getAttribute("title");if(e==0){updateTarget(d,b,i);if(d=="AddPage"||d=="gedcom"){window.location="/w/index.php?title="+encodeURIComponent(b+":"+i)+"&action=edit"+generateUrlParms(a)}else{if(b=="Person"||b=="Family"){promptForPerson(d,i,a)}else{setTimeout(closeWindow,10)}}}else{if(d=="AddPage"||d=="gedcom"){window.location="/wiki/Special:AddPage?confirm=true&target="+encodeURIComponent(d)+"&namespace="+encodeURIComponent(b)+generateUrlParms(a)}else{c.css("display","none");var f=g[0].getAttribute("error");$("<div></div>").html(escapeHtml(f)).dialog({title:"Cannot add page",resizable:false,modal:true,buttons:{Ok:function(){$(this).dialog("destroy")}}})}}})}}function addPersonPage(h){var b=getFormValue("g");var f=getFormValue("s");var i=getFormValue("gnd");var g=getFormValue("bd");var c=getFormValue("bp");var k=getFormValue("dd");var d=getFormValue("dp");var a=getFormValue("pf");var e=getFormValue("sf");var j=getFormValue("wg");var l=getFormValue("ws");addPage("Person",h,{g:b,s:f,gnd:i,bd:g,bp:c,dd:k,dp:d,pf:a,sf:e,wg:j,ws:l})}function addFamilyPage(f){var h=getFormValue("gnd");var i=getFormValue("hg");var g=getFormValue("hs");var j=getFormValue("wg");var k=getFormValue("ws");var b=getFormValue("md");var a=getFormValue("mp");var e=getFormValue("ct");var d=getFormValue("ht");var c=getFormValue("wt");addPage("Family",f,{hg:i,hs:g,wg:j,ws:k,gnd:h,md:b,mp:a,ht:d,wt:c,ct:e})}function addSourcePage(e,b,g,d){b=decodeURIComponent(b);g=decodeURIComponent(g);d=decodeURIComponent(d);var f=getFormValue("st");var c=getFormValue("a");var a=getFormValue("p");addPage("Source",e,{sty:b,st:f,a:c,p:a,pi:g,pu:d})}function addMySourcePage(d){var e=getFormValue("t");var b=getFormValue("a");var a=getFormValue("p");var c=getFormValue("s");addPage("MySource",d,{t:e,a:b,p:a,s:c})}function addPlacePage(b){var a=getFormValue("pn");var c=getFormValue("li");addPage("Place",b,{pn:a,li:c})}function readcache(){$("#addpage_cache").each(function(){var m=/[&?]target=([^&#]*)/;var h=m.exec(window.location.href);h=(h&&h[1]?h[1]:"AddPage");m=/[&?](pf|sf|ht|wt|ct)=([^&#])/;var n=$("#ns").val();var l=getAcStorageKey(n);try{var f=$.jStorage.get(l,"");if(f.length>0){var a=$(this);var j=(n=="Family"?"Families":(n=="Person"?"People":n+"s"));a.prepend("<h4>"+j+' you\'ve recently added or selected &nbsp; <span id="pleasewait" style="display:none"><span style="font-size: 80%; padding: 0 .2em; color: #fff; background-color: #888">Please Wait</span></span></h4>');f=f.split("|");for(var c=0;c<Math.min((n=="Family"||n=="Person"?5:10),f.length);c++){var b=f[c].split("#");var d=$('<input type="submit" value="Select">').click(function(e){return function(){selectPage(h,n,encodeURIComponent(e))}}(b[0]));var k=$('<div class="cache_entry"/>').append(d).append("<span>"+escapeHtml(b[0])+"</span>");a.append(k)}a.show()}}catch(g){}})}$(document).ready(function(){showFocusSearchFields(true);bindExactClick();readcache()});