function replaceIdInTable(e,b,k,c,a,d){var g=e.rows.length;for(var f=a;f<g;f+=d){var h=e.rows[f].cells[b].getElementsByTagName("input")[0];var j=h.value.replace(k,c);if(c.length==0){j=j.replace(/\s*,\s*$/,"")}h.value=j}}function replaceIdInText(g,c){var e=new RegExp("\\{\\{cite\\s*\\|\\s*"+g+"\\s*(\\|[^\\}]*)?\\}\\}","mig");var d=new RegExp("\\[\\[#"+g+"\\s*(\\|[^\\]]*)?\\]\\]","mig");var b=new RegExp('<ref\\s*name="?'+g+'"?\\s*/>',"mig");var a=document.getElementById("wpTextbox1");var f=a.value.replace(e,c?"{{cite|"+c+"$1}}":"").replace(d,c?"[[#"+c+"$1]]":"").replace(b,c?'<ref name="'+c+'"/>':"");a.value=f}function replaceId(h,b,c,a,g){var f="\\b"+h+"\\b";if(b.length==0){f+="(\\s*,\\s*)?"}var d=new RegExp(f,"ig");var e=document.getElementById("name_input");if(c>=0&&e){replaceIdInTable(e,c,d,b,1,1)}e=document.getElementById("event_fact_input");if(a>=0&&e){replaceIdInTable(e,a,d,b,2,2)}e=document.getElementById("source_input");if(g>=0&&e){replaceIdInTable(e,g,d,b,3,5)}replaceIdInText(h,b)}function addName(f){f=f.split(",");var e=document.getElementById("name_input");$("span",e.rows[1].cells[0]).css("display","inline");var h=e.rows.length;var g=e.insertRow(h);var c=h-1;var a=g.insertCell(0);var d='<select class="n_select" tabindex="1" name="alt_name'+c+'"><option value="Unknown" selected="selected">Type of name</option>';for(var b=0;b<f.length;b++){d+='<option value="'+f[b]+'">'+f[b]+"</option>"}a.innerHTML=d+"</select>";a=g.insertCell(1);a.innerHTML='<input class="n_presuf" tabindex="1" type="text" name="title_prefix'+c+'"/>';a=g.insertCell(2);a.innerHTML='<input class="n_given" tabindex="1" type="text" name="given'+c+'"/>';a=g.insertCell(3);a.innerHTML='<input class="n_surname" tabindex="1" type="text" name="surname'+c+'"/>';a=g.insertCell(4);a.innerHTML='<input class="n_presuf" tabindex="1" type="text" name="title_suffix'+c+'"/>';a=g.insertCell(5);a.innerHTML='<a title="Add a source for this name" href="#sourcesSection" onClick="addRef(\'name_input\','+h+',6,newSource());">+</a>';a.className="n_plus";a=g.insertCell(6);a.innerHTML='<input class="n_ref" tabindex="1" type="text" name="name_sources'+c+'"/>';a=g.insertCell(7);a.innerHTML='<a title="Add a note for this name" href="#notesSection" onClick="addRef(\'name_input\','+h+',8,newNote());">+</a>';a.className="n_plus";a=g.insertCell(8);a.innerHTML='<input class="n_ref" tabindex="1" type="text" name="name_notes'+c+'"/>';a=g.insertCell(9);a.innerHTML='<a title="Remove this name" href="javascript:void(0);" onClick="removeName('+h+'); return preventDefaultAction(event);">remove</a>'}function removeName(f){var d=document.getElementById("name_input");$("a",d.rows[f]).unbind("click");d.deleteRow(f);var c=d.rows.length;for(var b=f;b<c;b++){var e=d.rows[b];var a=b-1;e.cells[0].getElementsByTagName("select")[0].name="alt_name"+a;e.cells[1].getElementsByTagName("input")[0].name="title_prefix"+a;e.cells[2].getElementsByTagName("input")[0].name="given"+a;e.cells[3].getElementsByTagName("input")[0].name="surname"+a;e.cells[4].getElementsByTagName("input")[0].name="title_suffix"+a;$("a",d.rows[b].cells[5]).removeAttr("onClick").unbind("click").click(function(g){return function(h){addRef("name_input",g,6,newSource())}}(b));e.cells[6].getElementsByTagName("input")[0].name="name_sources"+a;$("a",d.rows[b].cells[7]).removeAttr("onClick").unbind("click").click(function(g){return function(h){addRef("name_input",g,8,newNote())}}(b));e.cells[8].getElementsByTagName("input")[0].name="name_notes"+a;$("a",d.rows[b].cells[9]).removeAttr("onClick").unbind("click").click(function(g){return function(h){removeName(g);return preventDefaultAction(h)}}(b))}if(c==2){$("span",d.rows[1].cells[0]).css("display","none")}}function addRef(d,e,b,c){var a=document.getElementById(d).rows[e].cells[b].getElementsByTagName("input")[0];if(a.value.length>0){c=", "+c}a.value+=c}function moveAutoCompletes(d,a,c){for(var b=1;b<d.rows.length;b+=c){$("input",d.rows[b].cells[a]).autocompleteMove()}}function addEventFact(a){a=a.split(",");var e=document.getElementById("event_fact_input");var g=e.rows.length;var c=(g-1)/2;var l=e.insertRow(g);var k=l.insertCell(0);var d='<select class="ef_select" tabindex="1" name="event_fact'+c+'"><option value="Unknown">Type of event</option>';for(var f=0;f<a.length;f++){var b=a[f].replace(/~/g,"'");var j;var h;if(b.substring(0,1)=="="){b=b.substring(1,b.length);j=' disabled="disabled" style="color:GrayText"';h=""}else{j="";if(b.substring(0,1)==":"){h=b.substring(1,b.length);b="\xa0\xa0"+h}else{h=b}}d+='<option value="'+h+'"'+j+">"+b+"</option>"}k.innerHTML=d+"</select>";k.getElementsByTagName("select")[0].focus();k=l.insertCell(1);k.innerHTML='<input class="ef_date" tabindex="1" type="text" name="date'+c+'"/>';k=l.insertCell(2);k.innerHTML='<input class="ef_place" tabindex="1" type="text" name="place'+c+'"/>';$("input",k).autocomplete({url:"/pac?q=",pgSize:4,matchCommaPhrases:1,ignoreCase:1});k=l.insertCell(3);k.colSpan=2;k.innerHTML='<input class="ef_desc" tabindex="1" type="text" name="desc'+c+'"/>';k=l.insertCell(4);k.innerHTML='<a title="Remove this event/fact" href="javascript:void(0);" onClick="removeEventFact('+(c+1)+'); return preventDefaultAction(event);">remove</a>';l=e.insertRow(g+1);k=l.insertCell(0);k.colSpan=2;k.innerHTML="";k=l.insertCell(1);k.className="ef_ref";k.innerHTML='<a title="Add a source for this event/fact" href="#sourcesSection" onClick="addRef(\'event_fact_input\','+(g+1)+',1,newSource());">+</a><input tabindex="1" type="text" name="sources'+c+'"/>';k=l.insertCell(2);k.className="ef_ref";k.innerHTML='<a title="Add an image for this event/fact" href="#imagesSection" onClick="addRef(\'event_fact_input\','+(g+1)+',2,newImage());">+</a><input tabindex="1" type="text" name="images'+c+'"/>';k=l.insertCell(3);k.className="ef_ref";k.innerHTML='<a title="Add a note for this event/fact" href="#notesSection" onClick="addRef(\'event_fact_input\','+(g+1)+',3,newNote());">+</a><input tabindex="1" type="text" name="notes'+c+'"/>';if(e.rows[g-1].cells[0].getElementsByTagName("select").length==0){moveAutoCompletes(e,2,2)}}function removeEventFact(b){var h=(b-1)*2+1;var f=document.getElementById("event_fact_input");var e=f.rows.length;var g;for(var d=h;d<e-2;d+=2){g=f.rows[d];var a=f.rows[d+2];var c;$(g.cells[0]).find("select").val($(a.cells[0]).find("select").val());for(c=1;c<=3;c++){$(g.cells[c]).find("input").val($(a.cells[c]).find("input").val())}g=f.rows[d+1];a=f.rows[d+3];for(c=1;c<=3;c++){$(g.cells[c]).find("input").val($(a.cells[c]).find("input").val())}}$("input",f.rows[e-2].cells[2]).autocompleteRemove();for(d=1;d<=2;d++){f.deleteRow(e-d)}if(f.rows[f.rows.length-1].cells[0].getElementsByTagName("select").length==0){moveAutoCompletes(f,2,2)}}function addSource(){newSource()}function newSource(){var c=document.getElementById("source_input");var f=c.rows.length;var e=f/5;var b="S"+(e+1);var d=c.insertRow(f);var a=d.insertCell(0);a.align="right";a.style.paddingTop="13px";a.innerHTML="<b>Citation ID</b>";a=d.insertCell(1);a.style.paddingTop="13px";a.innerHTML=b+'<input type="hidden" name="source_id'+e+'" value="'+b+'"/>&nbsp;&nbsp;&nbsp;<a title="Remove this source" href="javascript:void(0);" onClick="removeSource('+(e+1)+'); return preventDefaultAction(event);">remove</a>';d=c.insertRow(f+1);a=d.insertCell(0);a.align="right";a.innerHTML="Source";a=d.insertCell(1);a.innerHTML='<select id="source_namespace'+e+'" class="s_select" tabindex="1" name="source_namespace'+e+'" onChange="changeSourceNamespace('+e+",'"+b+'\')"><option value="" value="0" selected="selected">Citation only</option><option value="104">Source</option><option value="112">MySource</option></select>';a=d.insertCell(2);a.align="right";a.innerHTML="Title";a=d.insertCell(3);a.colSpan=8;a.innerHTML='<input id="'+b+'input" class="s_title" tabindex="1" type="text" name="source_title'+e+'" value=""/>&nbsp;<span style="font-size: 90%"><a id="'+b+'choose" style="visibility:hidden">find/add&nbsp;&raquo;</a></span>';d=c.insertRow(f+2);a=d.insertCell(0);a.align="right";a.innerHTML="Record&nbsp;name";a=d.insertCell(1);a.colSpan=10;a.innerHTML='<input class="s_recordname" tabindex="1" type="text" name="record_name'+e+'" value=""/>';d=c.insertRow(f+3);a=d.insertCell(0);a.align="right";a.innerHTML="Volume / Pages";a=d.insertCell(1);a.innerHTML='<input class="s_page" tabindex="1" type="text" name="source_page'+e+'" value=""/>';a=d.insertCell(2);a.align="right";a.innerHTML="Date";a=d.insertCell(3);a.innerHTML='<input class="s_date" tabindex="1" type="text" name="source_date'+e+'" value=""/>';a=d.insertCell(4);a.align="right";a.innerHTML="Quality";a=d.insertCell(5);a.innerHTML="";a.innerHTML='<select id="source_quality'+e+'" class="s_quality" tabindex="1" name="source_quality'+e+'"><option value="" selected="selected">Select</option><option value="0">Unreliable</option><option value="1">Questionable</option><option value="2">Secondary</option><option value="3">Primary</option></select>';a=d.insertCell(6);a.colSpan=2;a.align="right";a.innerHTML='&nbsp;Images&nbsp;<a title="Add an image to this citation" href="#imagesSection" onClick="addRef(\'source_input\','+(f+2)+',7,newImage());">+</a>';a=d.insertCell(7);a.innerHTML='<input class="s_ref" tabindex="1" type="text" name="source_images'+e+'" value=""/>';a=d.insertCell(8);a.align="right";a.innerHTML='Notes&nbsp;<a title="Add a note to this citation" href="#notesSection" onClick="addRef(\'source_input\','+(f+2)+',9,newNote());">+</a>';a=d.insertCell(9);a.innerHTML='<input class="s_ref" tabindex="1" type="text" name="source_notes'+e+'" value=""/>';d=c.insertRow(f+4);a=d.insertCell(0);a.align="right";a.innerHTML="Text /<br/>Transcription<br/>location";a=d.insertCell(1);a.colSpan=10;a.innerHTML='<textarea class="s_text" tabindex="1" name="source_text'+e+'" rows="3"></textarea>';return b}function removeSource(h){replaceId("S"+h,"",6,1,-1);var g=(h-1)*5;var e=document.getElementById("source_input");var d=e.rows.length;for(var b=g;b<d-5;b+=5){h=b/5;var c="S"+(h+1);replaceId("S"+(h+2),c,6,1,-1);var f=e.rows[b+1];var a=e.rows[b+6];$(f.cells[1]).find("select").val($(a.cells[1]).find("select").val());$(f.cells[3]).find("input").val($(a.cells[3]).find("input").val());f=e.rows[b+2];a=e.rows[b+7];$(f.cells[1]).find("input").val($(a.cells[1]).find("input").val());f=e.rows[b+3];a=e.rows[b+8];$(f.cells[1]).find("input").val($(a.cells[1]).find("input").val());$(f.cells[3]).find("input").val($(a.cells[3]).find("input").val());$(f.cells[5]).find("select").val($(a.cells[5]).find("select").val());$(f.cells[7]).find("input").val($(a.cells[7]).find("input").val());$(f.cells[9]).find("input").val($(a.cells[9]).find("input").val());$(e.rows[b+4].cells[1]).find("textarea").val($(e.rows[b+9].cells[1]).find("textarea").val());changeSourceNamespace(h,c)}$("input",e.rows[d-4].cells[3]).autocompleteRemove();for(b=1;b<=5;b++){e.deleteRow(d-b)}}function addImage(){newImage()}function newImage(){var c=document.getElementById("image_input");var e=c.rows.length;$(c).css("display","block");var d=c.insertRow(e);var f=e-1;var b="I"+e;var a=d.insertCell(0);a.align="center";a.innerHTML=b+'<input type="hidden" name="image_id'+f+'" value="'+b+'"/>';a=d.insertCell(1);a.align="center";a.innerHTML='<input tabindex="1" type="checkbox" name="image_primary'+f+'"/>';a=d.insertCell(2);a.innerHTML='<input id="'+b+'input" tabindex="1" type="text" size=40 name="image_filename'+f+'"/>';$("input",a).autocomplete({defaultNs:"Image",userid:userId});a.getElementsByTagName("input")[0].focus();a=d.insertCell(3);a.innerHTML='<span style="font-size: 90%"><a href="javascript:void(0);" onClick="choose(6,\''+b+'input\'); return preventDefaultAction(event);">find&nbsp;&raquo;</a>&nbsp;<br><a href="javascript:void(0);" onClick="uploadImage(\''+b+"input'); return preventDefaultAction(event);\">add&nbsp;&raquo;</a>&nbsp;</span>";a=d.insertCell(4);a.innerHTML='<input tabindex="1" type="text" size=35 name="image_caption'+f+'"/>';a=d.insertCell(5);a.innerHTML='<a title="Remove this image" href="javascript:void(0);" onClick="removeImage('+e+'); return preventDefaultAction(event);">remove</a>';return b}function removeImage(g){replaceId("I"+g,"",-1,2,7);var e=document.getElementById("image_input");var d=e.rows.length;for(var c=g;c<d-1;c++){var f=e.rows[c];var a=e.rows[c+1];replaceId("I"+(c+1),"I"+c,-1,2,7);$(f.cells[1]).find("input")[0].checked=$(a.cells[1]).find("input")[0].checked;for(var b=2;b<=4;b++){$(f.cells[b]).find("input").val($(a.cells[b]).find("input").val())}}$("input",e.rows[d-1].cells[1]).autocompleteRemove();e.deleteRow(d-1);if(e.rows.length==1){$(e).css("display","none")}}function addNote(){newNote()}function newNote(){var c=document.getElementById("note_input");var e=c.rows.length;$(c).css("display","block");var d=c.insertRow(e);var f=e-1;var b="N"+e;var a=d.insertCell(0);a.align="center";a.innerHTML=b+'<input type="hidden" name="note_id'+f+'" value="'+b+'"/>';a=d.insertCell(1);a.innerHTML='<textarea tabindex="1" name="note_text'+f+'" rows="3" cols="85"></textarea>';a.getElementsByTagName("textarea")[0].focus();a=d.insertCell(2);a.innerHTML='<a title="Remove this Note" href="javascript:void(0);" onClick="removeNote('+e+'); return preventDefaultAction(event);">remove</a>';return b}function removeNote(f){replaceId("N"+f,"",8,3,9);var d=document.getElementById("note_input");var c=d.rows.length;for(var b=f;b<c-1;b++){var e=d.rows[b];var a=d.rows[b+1];replaceId("N"+(b+1),"N"+b,8,3,9);$(e.cells[1]).find("textarea").val($(a.cells[1]).find("textarea").val())}d.deleteRow(c-1);if(d.rows.length==1){$(d).css("display","none")}}function fixupPersonFamilyRows(a,d,f){var c=d.rows.length;if(!f){f=0}for(var b=f;b<c;b++){var e=d.rows[b];$("input",e.cells[0]).val(b+1).attr("name",a+"_id"+b);$("input",e.cells[1]).attr("name",a+b).attr("id",a+b);$("a",e.cells[2]).removeAttr("onclick").unbind("click").click((function(g){return function(h){removePersonFamily(a,g);return preventDefaultAction(h)}}(b)))}}function removePersonFamily(a,c){var b=document.getElementById(a+"_table");b.deleteRow(c);fixupPersonFamilyRows(a,b,c);if(b.rows.length==0&&(a=="husband"||a=="wife"||a=="child_of_family")){$("#"+a+"_addlink").show()}}function choose_internal(g,b,h,d,e){var i="";if(g==108){i="&gnd="+encodeURIComponent(h)+"&g="+encodeURIComponent(d)+"&s="+encodeURIComponent(e)}else{if(g==110&&b.indexOf("spouse_of_family")===0){d=$.trim($("#given0").attr("value"));if(!d||d=="Unknown"){d=""}e=$.trim($("#surname0").attr("value"));if(!e||e=="Unknown"){e=""}h=$("#gender").attr("value");if((!d&&!e)||!(h=="M"||h=="F")){alert("You must enter this person's name and gender first");return false}i+="&gnd="+encodeURIComponent(h);i+=(h=="M"?"&hg=":"&wg=")+encodeURIComponent(d);i+=(h=="M"?"&hs=":"&ws=")+encodeURIComponent(e)}else{if(g==104||g==118){i="&st="+encodeURIComponent($("#"+b).val())}else{if(g==112){i="&t="+encodeURIComponent($("#"+b).val())}}}}var f;if(g==6){f="Special:Search";i+="&ns=Image"}else{f="Special:AddPage";i+="&namespace="+encodeURIComponent(g)}var c=875;if(c>screen.width){c=screen.width}var a=window.open("/wiki/"+f+"?target="+b+i,"","height=600,width="+c+",scrollbars=yes,resizable=yes,toolbar=yes,menubar=no,location=no,directories=no");return true}function addPage(a,j,c,e){var h="";var l;var f="";if(a=="spouse_of_family"||a=="child_of_family"){f=="family_input";h="Family";l=110}else{f=="person_input";h="Person";l=108}var d=document.getElementById(a+"_table");var i=d.rows.length;var m=d.insertRow(i);var b=i;var k=m.insertCell(0);k.innerHTML='<input type="hidden" name="'+a+"_id"+b+'" value="'+(b+1)+'"/>';k=m.insertCell(1);k.innerHTML='<input id="'+a+b+'" class="'+f+'" tabindex="1" type="text" size=40 name="'+a+b+'" value=""/>';k=m.insertCell(2);k.innerHTML='<a href="javascript:void(0);" onClick="removePersonFamily(\''+a+"',"+b+'); return preventDefaultAction(event);">remove</a>';$("#"+a+b).autocomplete({defaultNs:h,userid:userId});var g=choose_internal(l,a+b,j,c,e);if(!g){d.deleteRow(i)}else{if(a=="husband"||a=="wife"||a=="child_of_family"){$("#"+a+"_addlink").hide()}}}function choose(a,c){var b=choose_internal(a,c,"","","")}function uploadImage(c){var b=document.URL.replace(/.*?\?title=(.*?)&.*/i,"$1");var a=window.open("/wiki/Special:Upload?target="+b+"&id="+c,"","height=600,width=700,scrollbars=yes,resizable=yes,toolbar=yes,menubar=no,location=no,directories=no")}function changeSourceNamespace(c,d){var b=$("#source_namespace"+c).val();if(b==104||b==112){var a=(b==104?"Source":"MySource");$("#"+d+"input").autocompleteRemove().autocomplete({defaultNs:a,userid:userId});$("#"+d+"choose").attr("href","javascript:void(0);").removeAttr("onClick").unbind("click").click(function(e){choose(b,d+"input");return preventDefaultAction(e)}).css("visibility","visible")}else{$("#"+d+"input").autocompleteRemove();$("#"+d+"choose").css("visibility","hidden")}}$(document).ready(function(){$("#child_of_family_table, #spouse_of_family_table, #husband_table, #wife_table, #child_table").tableDnD({onDrop:function(b,c){var d=$(b).attr("id");var a=d.substr(0,d.length-6);fixupPersonFamilyRows(a,b)}})});